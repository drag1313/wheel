import 'package:shared_preferences/shared_preferences.dart';
import 'dart:convert';

import 'package:wheel2/task_manager/task.dart';
import 'package:wheel2/task_manager/topic.dart';

class DataService {
  static List<Topic> topics = [];
  static List<Task> tasks = [];

  static Future<void> init() async {
    final prefs = await SharedPreferences.getInstance();
    if (!prefs.containsKey('initialized')) {
      await _createInitialData();
      await prefs.setBool('initialized', true);
    }
    await _loadData();
  }

  static Future<void> resetData() async {
    final prefs = await SharedPreferences.getInstance();
    await prefs.remove('initialized'); // Удаляем флаг инициализации
    await prefs.remove('topics'); // Удаляем сохраненные темы
    await prefs.remove('tasks'); // Удаляем сохраненные задачи
    topics.clear(); // Очищаем текущие списки
    tasks.clear();
  }

  static Future<void> _createInitialData() async {
    // Здоровье
    _addTopic(
      id: 'health',
      name: 'Здоровье',
      descriptions: [
        'Начните с базовых привычек',
        'Регулярные проверки здоровья',
        'Эксперт здорового образа жизни',
      ],
      tasks: [
        [
          'Ранний подъем и ночной сон',
          'Начинать утро с подъема до восхода солнца (например, в 6 утра) и соблюдать правило отхода ко сну до полуночи. Сон — важнейший ресурс для восстановления организма, особенно если просыпаться рано и успевать отдохнуть полноценно.',
        ],
        [
          'Употребление достаточного количества воды',
          'Выпивать каждое утро стакан тёплой воды с лимонным соком, далее равномерно употреблять чистую воду в течение дня (2-3 литра). Это улучшает обмен веществ, выводит токсины и увлажняет ткани.',
        ],
        [
          'Регулярные занятия физическими упражнениями ',
          'Давать организму небольшую нагрузку ежедневно: лёгкие прогулки, утренняя зарядка, йога или плавание. Достаточно уделять этому хотя бы 15-30 минут в день, чтобы поддерживать тонус мышц и сердечно-сосудистую систему.',
        ],
        [
          'Правильное питание ',
          'Постепенно перейти на рацион, богатый овощами, зеленью, рыбой, яйцами, молочными продуктами и исключить избыток сахара, мучного и жирных продуктов. Планомерно уменьшать порции еды и привыкать есть медленно, наслаждаясь каждым кусочком пищи.',
        ],
        [
          'Использование антиоксидантов и витаминов ',
          ' Включить в рацион богатые антиоксидантами продукты (ягоды, зелёный чай, оливковое масло) и добавить витаминные добавки (магний, омега-3, витамины группы B) по рекомендации врача.',
        ],
        [
          'Отказ от вредных привычек  ',
          'Сделать первый шаг к отказу от курения и чрезмерного употребления алкоголя. Можно уменьшить дозы постепенно, переходя на более мягкие альтернативы (чай вместо кофе, травяные отвары вместо спиртного).',
        ],
        [
          'Управление стрессом ',
          'Практиковать техники расслабления и антистресса: медитация, глубокая дыхательная практика, чтение книг или прослушивание классической музыки. Всё это успокаивает нервы и улучшает качество сна.',
        ],
        [
          'Свежий воздух и природа ',
          'Чаще бывать на улице, гулять в парках, лесах или возле водоемов. Свежий воздух оздоравливает органы дыхания, улучшает мозговую активность и дарит позитивные эмоции.',
        ],
        [
          'Соблюдение гигиены и чистоты',
          'Принимать теплую ванну или контрастный душ дважды в день, чистить зубы дважды в день и держать руки чистыми. Чистота кожи и зубов важна для профилактики инфекций и поддержания иммунитета.',
        ],
        [
          'Посещение врачей и профилактика ',
          'Пройди полное обследования (Чек ап организва)  у терапевта, стоматолога, офтальмолога и других специалистов. Профилактика заболеваний гораздо эффективнее лечения запущенных состояний.',
        ],
        [
          ' Планирование и дисциплина  ',
          'Завести календарь и расписывать каждый день, фиксируя время для отдыха, занятий спортом, приёма пищи и учёбы. Дисциплина и порядок помогают легче справляться с любыми задачами и сохранять внутреннее спокойствие.',
        ],
      ],
    );

    // Друзья
    _addTopic(
      id: 'friends',
      name: 'Друзья',
      descriptions: [
        'Начните с общения',
        'Активное поддержание связей',
        'Душа компании',
      ],
      tasks: [
        [
          'Встречи с друзьями',
          'Регулярно встречаться с друзьями лицом к лицу, устраивать посиделки, походы в кино, театры, музеи или просто прогулки по городу. Желательно встречаться хотя бы раз в месяц, чтобы сохранить тесные связи и поддерживать общение',
        ],
        [
          'Телефонные звонки',
          ' Завести привычку звонить друзьям хотя бы раз в неделю, чтобы поинтересоваться их делами, спросить о самочувствии и настроении. Телефонный звонок может напомнить другу, что он важен и дорог вам.',
        ],
        [
          'Помощь друзьям',
          'Оказывать бескорыстную помощь друзьям, помогать им решать бытовые или рабочие вопросы, заботиться о нуждах и проблемах близких людей. Иногда простая поддержка способна укрепить дружбу.',
        ],
        [
          'Совместные хобби',
          'Интересуйтесь увлечениями друзей, предлагайте совместно заняться каким-нибудь хобби, например, фотографией, туризмом, кулинарией или спортивными играми. Общий интерес сблизит вас и даст повод для приятных воспоминаний.',
        ],
        [
          'Поздравления и подарки',
          'Не пропускайте важные даты друзей: дни рождения, юбилеи, свадьбы, рождение ребенка. Поздравляйте своевременно, дарите подарки, делитесь приятными словами и вниманием.',
        ],
        [
          'Открытые диалоги',
          'Будьте открыты к разговорам с друзьями, высказывайте своё мнение и прислушивайтесь к мнению собеседника. Разговаривайте искренне, честно и конструктивно, не боясь обсудить деликатные темы.',
        ],
        [
          'Поддержка в кризисные времена',
          'Подставляйте плечо друзьям в тяжёлые периоды их жизни: болезни, потери, неудачи. Помогите словом, делом или личным присутствием, чтобы показать истинную заботу и искренность.',
        ],
        [
          'Постоянное обновление контактов',
          'Храните актуальные контактные данные друзей: номера телефонов, адреса электронной почты, страницы в социальных сетях. Регулярно проверяйте контакты, чтобы вовремя связаться и предложить помощь.',
        ],
        [
          'Радостные сюрпризы',
          'Делайте друзьям приятные сюрпризы: принесите пирог на чашечку чая, пришлите открытку по почте, угостите вкусняшками, отправьте забавную фотографию. Приятные неожиданности доставляют радость и укрепляют дружбу.',
        ],
        [
          'Возвращение долга',
          'Возвращайте долги друзьям своевременно, независимо от размера суммы или характера обязательства. Человек чувствует уважение и признание, когда долг погашается добровольно и ответственно.',
        ],
        [
          'Открытость и дружелюбие',
          'Будьте приветливы и доброжелательны с новыми людьми, заводите знакомства, расширяйте круг общения. Широкая сеть знакомых полезна в любых жизненных ситуациях и помогает находить нужных людей.',
        ],
        [
          'Похвала и одобрение',
          'Похвалите друзей за успехи, достижения и достоинства. Объясните, что вы гордитесь ими и восхищаетесь их талантами и качествами. Поддержка и одобрения мотивируют людей развиваться и расти.',
        ],
        [
          'Непринятие критики близко к сердцу',
          'Критика бывает неприятной, но воспринимайте её объективно и спокойно. Спросите, что конкретно вызвало недовольство, и примите меры по устранению негативных моментов.',
        ],
        [
          ' Безусловное принятие',
          'Признайте право друга иметь собственное мнение, взгляды и убеждения, отличные от ваших. Не пытайтесь навязать своё мировоззрение, уважайте независимость и самостоятельность друзей',
        ],
      ],
    );

    // Остальные темы
    _addTopic(
      id: 'development',
      name: 'Развитие',
      descriptions: [
        'Чтение книг',
        'Регулярное обучение',
        'Профессиональный рост',
      ],
      tasks: [
        [
          'Чтение книг',
          'Регулярно читайте книги по саморазвитию, психологии, биографии великих людей и научной фантастике. Выделяйте хотя бы 30 минут в день на чтение. Это расширяет кругозор, улучшает речь и развивает креативность.',
        ],
        [
          'Физическая активность',
          'Занимайтесь спортом или йогой хотя бы 3 раза в неделю. Физическая активность заряжает энергией, поднимает настроение и улучшает здоровье. Регулярные тренировки укрепляют волю и дисциплину.',
        ],
        [
          'Ментальное развитие',
          'Практикуйте медитацию, дыхательную гимнастику или занятия на развитие памяти и мышления. Например, головоломки, кроссворды, шахматы. Это помогает успокоить ум, улучшить концентрацию и внимательность.',
        ],
        [
          'Развитие речи и письма',
          'Пишите тексты, статьи, дневники или посты в блоге. Это улучшает литературные навыки, облегчает общение и позволяет выразить свои мысли ясно и понятно. Регулярно озвучивайте написанное вслух, чтобы слышать звучание речи.',
        ],
        [
          'Творческое развитие',
          'Займитесь живописью, музыкой, танцами или любым видом творчества. Творчество раскрепощает сознание, снимает стресс и развивает воображение. Оно помогает освободиться от шаблонов и стереотипов.',
        ],
        [
          'Путешествия и приключения',
          'Путешествуйте, исследуйте новые города и страны, знакомьтесь с культурами и обычаями народов. Новизна стимулирует любопытство, развивает наблюдательность и расширяет представление о мире.',
        ],
        [
          'Социальные навыки',
          'Регулярно посещайте общественные мероприятия, собрания клубов, конференции и выставки. Это развивает навыки общения, расширяет круг знакомств и позволяет познакомиться с новыми людьми.',
        ],
        [
          'Навыки публичного выступления',
          'Практикуйтесь выступать публично, произносите речи, рассказывайте истории, учитесь убеждать слушателей. Регулярные выступления перед публикой повышают уверенность в себе и умение владеть ситуацией.',
        ],
        [
          'Обратная связь',
          'Просите у окружающих обратную связь о ваших действиях, словах и поступках. Честная и открытая обратная связь помогает понять, как воспринимают вас другие, и исправить нежелательные черты.',
        ],
        [
          'Хобби и интересное времяпрепровождение',
          'Найдите себе интересное хобби, которым будете заниматься регулярно. Например, коллекционирование марок, цветоводство, фотография или вышивка крестиком. Хобби развивает терпение, усидчивость и придает жизни дополнительное содержание.',
        ],
        [
          'Принятие ответственности',
          'Принято брать ответственность за свои действия и последствия. Решите, что ваша судьба находится в ваших руках, и действуйте соответствующим образом. Это повышает самооценку и заставляет действовать решительно.',
        ],
        [
          'Позитивное мышление',
          'Развивайте позитивное мышление, концентрируйтесь на сильных сторонах и успехах. Визуализируйте цели и представляйте, как вы их достигнете. Позитивное мышление помогает преодолевать трудности и оставаться уверенным в себе.',
        ],
        [
          'Самообучение',
          'Постоянно учитесь чему-то новому: иностранным языкам, математике, дизайну или программированию. Самоорганизация и стремление к знаниям помогают расти профессионально и личностно.',
        ],
        [
          'Управляемое мышление',
          'Регулярно очищайте голову от мыслей, тревожащих вас. Записывайте их на бумаге, формулируя намерения и цели. Затем приступайте к решению проблем последовательно и целенаправленно.',
        ],
      ],
    );

    _addTopic(
      id: 'hobby',
      name: 'Хобби',
      descriptions: [
        'Найти увлечение',
        'Регулярная практика',
        'Профессионал хобби',
      ],
      tasks: [
        [
          ' Выделение времени на хобби',
          'Регулярно отводите время для своего увлечения. Например, установите правило посвящать хобби хотя бы один час в день или пару часов в неделю. Без постоянного контакта с любимым делом сложно почувствовать удовлетворение и прогресс.',
        ],
        [
          'Экспериментирование и разнообразие',
          ' Не бойтесь экспериментировать и менять подходы к своему хобби. Попробуйте новые техники, жанры, инструменты или материалы. Эксперименты помогут раскрыть творческий потенциал и обнаружить новые грани таланта.',
        ],
        [
          'Постановка целей и планирование',
          'Устанавливайте конкретные цели и составляйте планы их достижения. Например, за месяц выучить новую мелодию на гитаре, написать главу романа или изготовить предмет искусства. Четкие цели обеспечивают мотивацию и придают смысл вашим усилиям.',
        ],
        [
          'Учёт и регистрация прогресса',
          'Записывайте свои достижения и прогресс. Это может быть журнал успехов, фотоальбом, таблица рекордов или доска достижений. Видимые результаты поднимают самооценку и вдохновляют на продолжение занятий.',
        ],
        [
          'Сообщество единомышленников',
          'Вступайте в клубы, форумы или сообщества любителей вашего хобби. Общение с людьми, увлечёнными той же темой, открывает новые горизонты, обмен знаниями и возможностями для совместной деятельности.',
        ],
        [
          ' Активное участие в мероприятиях',
          'Участвуйте в соревнованиях, фестивалях, выставках или концертах, связанных с вашим хобби. Выступления и демонстрации демонстрируют результаты вашей работы и способствуют развитию навыков публичных выступлений.',
        ],
        [
          'Поиск источников вдохновения',
          ' Ищите вдохновение в окружающей среде, литературе, музыке, кинематографе или путешествиях. Вдохновение — двигатель творчества, поэтому постоянно пополняйте запас идей и образов.',
        ],
        [
          'Переоценка и изменение интересов',
          'Время от времени переоценивайте свои увлечения и интересуйтесь смежными видами деятельности. Это позволяет обновить взгляд на старое хобби и открыть новые направления для творческого роста',
        ],
        [
          'Умение учиться самостоятельно',
          'Самостоятельно овладевать знаниями и навыками — важный компонент любого хобби. Читайте книги, смотрите видеоуроки, посещайте лекции и семинары, чтобы непрерывно повышать квалификацию.',
        ],
        [
          'Расстановка приоритетов',
          'Определите важность своего хобби среди прочих обязательств и устанавливайте приоритеты соответственно. Взвешенно распределяйте время и силы, чтобы хобби приносило радость и удовольствие.',
        ],
        [
          'Критика и саморефлексия',
          'Учитесь воспринимать критику объективно и анализировать свои недостатки. Саморефлексия позволяет заметить ошибки и устранить их, что ускоряет развитие мастерства.',
        ],
        [
          'Заключение договоренностей',
          'Договаривайтесь с другими энтузиастами о совместных занятиях или выступлениях. Командная работа помогает развить коммуникативные навыки и приобрести новые связи.',
        ],
        [
          'Накопление инструментов и материалов',
          'Регулярно пополняйте коллекцию инструментов и материалов, необходимых для вашего хобби. Хорошие инструменты упрощают работу и позволяют создавать качественные произведения.',
        ],
        [
          'Добросовестность и упорство',
          'Постоянно повышайте уровень усердия и стойкости. Успех приходит не сразу, но регулярная работа над совершенствованием способностей непременно вознаграждается результатом.',
        ],
      ],
    );

    _addTopic(
      id: 'work',
      name: 'Работа',
      descriptions: [
        'Освойте базовые навыки',
        'Повышайте квалификацию',
        'Эксперт в профессии',
      ],
      tasks: [
        [
          'Минимум 3 собеседования в год',
          'Даже если доволен работой — ходить на 3 собеседования ежегодно.  Эффект: Понимание своей рыночной стоимости + возможность неожиданных офферов.  ',
        ],
      ],
    );

    // Финансы
    _addTopic(
      id: 'finance',
      name: 'Финансы',
      descriptions: [
        'Контроль расходов',
        'Инвестирование основ',
        'Финансовая независимость',
      ],
      tasks: [
        [
          'Правило 24 часов для крупных покупок',
          'Перед покупкой дорогих вещей (>10% месячного дохода) ждать 24 часа.  Эффект: Снижение импульсных трат на 30–50% уже через месяц.',
        ],
        [
          'Автоплатежи по зарплате',
          'Настроить автоматическое перечисление 10–20% дохода на отдельный счет сразу после получения зарплаты.  Эффект: Через полгода — «подушка безопасности» = 1–2 месячных дохода.',
        ],
        [
          'Одна монетизация в месяц',
          ' Раз в месяц пробовать новый способ заработка (фриланс, продажа ненужного, курс и т.д.).  Эффект: Через 3–6 месяцев — дополнительные 15–30% к доходу. ',
        ],
        [
          'Финансовый дневник',
          ' 5 минут в день записывать все траты в приложении или таблице.  Эффект: Через 2 недели — четкое понимание, куда уходят деньги.',
        ],
      ],
    );

    // Отношения
    _addTopic(
      id: 'relationships',
      name: 'Отношения',
      descriptions: [
        'Укрепление связей',
        'Гармоничные отношения',
        'Эксперт коммуникаций',
      ],
      tasks: [
        [
          ' Семейные ужины',
          ' Начните с сегодняшнего дня собираться всей семьей за общим столом минимум трижды в неделю. Во время ужина отключите телефоны, поговорите обо всём хорошем, что произошло за день, послушайте детей и супругов, обсудите предстоящие планы.',
        ],
        [
          'Регулярные свидания',
          'Выделите один вечер в неделю только для вашего супруга/супруги. Вместе сходите в кино, театр, кафе или просто погуляйте в парке. Основное условие — никаких телефонов и посторонних отвлекающих факторов.',
        ],
        [
          'Время для детей',
          'Проведите один час каждый день, полностью посвятив его ребёнку. Почитайте книгу, нарисуйте вместе, соберите пазл или просто пообщайтесь, выслушав ребёнка внимательно и без раздражения',
        ],
        [
          'Поддержка близкого человека',
          'Когда любимый человек испытывает трудности, подойдите и скажите простую фразу: «Я рядом». Просто подержите за руку, посмотрите в глаза, дайте понять, что вы любите и поддерживаете его.',
        ],
        [
          ' Искренние разговоры',
          'Установите традицию делиться мыслями и чувствами раз в неделю. Например, устройте встречу в субботу вечером, поговорите откровенно, расскажите о своих тревогах и надеждах, задавайте вопросы и внимательно слушайте.',
        ],
        [
          'Общее хобби',
          'Купите краски и бумагу и вместе займитесь творчеством. Или пригласите всех членов семьи поиграть в настольную игру, покататься на велосипеде или сходить на природу. Главное — делайте это регулярно, раз в неделю или чаще.',
        ],
        [
          ' Поздравления и празднования памятных дат',
          'Нарисуйте календарь памятных дат и торжественных событий семьи и разместите его на холодильнике. За месяц до праздника подготовьтесь: купите подарок, сделайте открытку вручную, испеките торт или украсьте дом гирляндами и цветами.',
        ],
        [
          'Забота о родителях',
          ' Посетите родителей хотя бы раз в неделю, позвоните им ежедневно. Если родители живут далеко, заведите привычку писать письма, присылать фотографии, рассказывать о своих делах и успехах.',
        ],
        [
          'Качество общения',
          'Вместо телевизора или смартфона садитесь всей семьёй читать книгу вслух. Выбирайте произведения, подходящие возрасту детей, и регулярно обсуждайте прочитанное.',
        ],
        [
          'Романтичность и страсть',
          'Сделайте приятное вашему партнёру совершенно неожиданно: приготовьте ужин сами, напишите любовное письмо или поцелуйте с закрытыми глазами. Маленькие знаки внимания сохранят огонь страсти.',
        ],
        [
          'Любовь и прощение',
          ' Сегодня же попросите прощения у близкого человека, если совершили ошибку. Напишите записку с признанием вины и просьбой принять извинения. Потом забудьте о случившемся и двигайтесь вперёд.',
        ],
        [
          'Традиции и обычаи',
          'Придумайте собственную семейную традицию, например, поездку в горы на День семьи или субботний семейный обед. Введите правило готовить особое блюдо, петь песню или зажигать свечи в честь семейной традиции.',
        ],
        [
          ' Верность и преданность',
          ' Каждый день признавайтесь любимому человеку в верности и любви. Говорите коротко и ясно: «Я выбираю тебя навсегда». Держите данное слово и будьте примером верности для своих детей.',
        ],
        [
          'Эмоциональная зрелость',
          'Принимайте чувства другого человека спокойно и мудро. Услышав критику, поблагодарите за честность и попросите разъяснить ситуацию подробно. Научитесь распознавать чужие эмоции и отвечать на них адекватно.',
        ],
      ],
    );

    // Спорт
    _addTopic(
      id: 'sport',
      name: 'Спорт',
      descriptions: [
        'Начало тренировок',
        'Регулярные занятия',
        'Профессиональный уровень',
      ],
      tasks: [
        [
          'Регулярные тренировки',
          'Обязательно выделяйте время для занятий спортом: минимум 3-4 раза в неделю по 30-60 минут. Это могут быть занятия в зале, бег, плавание, йога или любые другие активности, которые нравятся именно вам.',
        ],
        [
          'Разминка и растяжка',
          'Прежде чем приступать к серьезным физическим нагрузкам, обязательно разогрейтесь и выполните разминку. После окончания тренировки завершите ее растяжкой, чтобы предотвратить травмы и боли в мышцах',
        ],
        [
          'Отслеживание прогресса',
          'Ведите дневник тренировок, записывая результаты, достижения и ощущения. Это поможет отслеживать прогресс, понимать свои слабости и улучшать физическую подготовку.',
        ],
        [
          'Диета и питание',
          'Составьте сбалансированную диету, богатую белками, углеводами и полезными жирами. Откажитесь от вредной пищи, алкоголя и сигарет. Пища играет ключевую роль в восстановлении организма после тренировок.',
        ],
        [
          'Сон и отдых',
          'Стремитесь к качественному сну, спите не менее 7-8 часов в сутки. Во сне организм восстанавливается и накапливает энергию для дальнейших тренировок.',
        ],
        [
          'Водный баланс',
          ' Пейте достаточно жидкости: не менее 2-3 литров воды в день. Особенно важно восполнять запасы влаги после интенсивных тренировок.',
        ],
        [
          'Индивидуальность и последовательность',
          'Выберите тот вид спорта, который доставляет вам удовольствие и соответствует вашим физическим возможностям. Занимайтесь регулярно и последовательно, постепенно увеличивая нагрузку.',
        ],
        [
          'Защита и экипировка',
          'Носите подходящую одежду и обувь для занятий спортом. Правильно подобранная экипировка предотвращает травмы и делает тренировки комфортными и безопасными.',
        ],
        [
          'Соревнования и соревнования',
          'Участвуйте в спортивных соревнованиях и турнирах, чтобы проверить свои силы и сравнить себя с другими спортсменами. Соревнование мотивирует и помогает достигнуть лучших результатов.',
        ],
        [
          'Командный дух',
          'Играйте в командные виды спорта: футбол, волейбол, баскетбол. Это развивает навыки координации, взаимодействия и социализации.',
        ],
        [
          'Правильный темп',
          'Не перегружайте себя и не форсируйте события. Начните с легких тренировок и постепенно увеличивайте интенсивность и продолжительность занятий',
        ],
        [
          'Польза для души',
          ' Занимайтесь спортом на открытом воздухе: бегайте в парке, катайтесь на велосипеде вдоль реки, гуляйте в лесу. Свежий воздух благотворно влияет на легкие и нервную систему.',
        ],
        [
          'Медицинский осмотр',
          'Регулярно проходите медицинское обследование, чтобы убедиться, что занятия спортом полезны для вашего здоровья и не наносят вреда.',
        ],
        [
          'Комплексы упражнений',
          'Используйте готовые комплексы упражнений или создавайте свои собственные, учитывая свои цели и задачи. Комплексные тренировки помогают гармонично развивать все группы мышц.',
        ],
      ],
    );

    await saveData();
  }

  static void _addTopic({
    required String id,
    required String name,
    required List<String> descriptions,
    required List<List<String>> tasks,
  }) {
    topics.add(Topic(id: id, name: name, descriptions: descriptions));

    for (var i = 0; i < tasks.length; i++) {
      DataService.tasks.add(
        Task(
          id: '${id}_task${i + 1}',
          topicId: id,
          title: tasks[i][0],
          description: tasks[i][1],
        ),
      );
    }
  }

  static Future<void> _loadData() async {
    final prefs = await SharedPreferences.getInstance();

    topics =
        (prefs.getStringList('topics') ?? [])
            .map((json) => Topic.fromJson(jsonDecode(json)))
            .toList();

    tasks =
        (prefs.getStringList('tasks') ?? [])
            .map((json) => Task.fromJson(jsonDecode(json)))
            .toList();
  }

  static Future<void> saveData() async {
    final prefs = await SharedPreferences.getInstance();

    await prefs.setStringList(
      'topics',
      topics.map((t) => jsonEncode(t.toJson())).toList(),
    );

    await prefs.setStringList(
      'tasks',
      tasks.map((t) => jsonEncode(t.toJson())).toList(),
    );
  }

  static void updateTaskStatus(String taskId, TaskStatus newStatus) {
    final task = tasks.firstWhere((t) => t.id == taskId);
    task.status = newStatus;
    saveData();
  }

  static void increaseTopicRating(String topicId) {
    final topic = topics.firstWhere((t) => t.id == topicId);
    topic.rating = (topic.rating + 0.5).clamp(0.1, 10.0);
    saveData();
  }
}
